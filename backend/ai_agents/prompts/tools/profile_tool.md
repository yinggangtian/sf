# 用户画像工具

## 工具名称
`get_user_profile`

## 功能描述
获取用户画像信息，包括性别、历史占卜次数、偏好问题类型等。用于个性化解释生成，使解读更贴合用户的历史模式和偏好。

## 参数说明

### 必填参数

- **user_id** (integer)
  - 描述：用户 ID
  - 说明：系统会查询该用户的历史数据和偏好设置

## 返回格式

```json
{
  "success": true,
  "profile": {
    "user_id": 123,
    "gender": "男",
    "birth_date": "1990-01-01",
    "location": "北京",
    "total_divinations": 15,
    "total_conversations": 8,
    "preferred_question_types": "事业、财运",
    "notification_enabled": true,
    "tags": ["理性", "事业导向"],
    "created_at": "2024-01-01T00:00:00Z",
    "updated_at": "2024-01-15T10:30:00Z"
  },
  "exists": true
}
```

## 使用示例

**输入：**
```python
{
  "user_id": 123
}
```

**输出：**
- 用户基本信息（性别、生日、地区）
- 占卜历史统计（总次数、常问类型）
- 用户标签（理性/感性、决策风格等）

## 用户不存在时的处理

如果用户画像不存在，返回默认画像：

```json
{
  "success": true,
  "profile": {
    "user_id": 123,
    "gender": null,
    "total_divinations": 0,
    "total_conversations": 0,
    "preferred_question_types": null
  },
  "exists": false
}
```

## 隐私保护声明

### 数据使用原则
1. **最小化原则**：仅获取必要的画像信息
2. **用途限制**：画像数据仅用于个性化解释，不用于其他目的
3. **安全存储**：用户数据加密存储，符合 GDPR 和中国个人信息保护法
4. **可删除性**：用户可随时要求删除个人画像数据

### 敏感信息处理
- **生日信息**：仅存储年份，不存储具体日期（如需精确八字另行授权）
- **地理位置**：仅存储城市级别，不存储详细地址
- **对话内容**：仅存储摘要，不存储完整对话记录

### 用户权利
- 查看个人画像：通过 API 或前端界面查看
- 修改画像信息：可更新性别、偏好等非敏感信息
- 删除画像数据：可要求系统删除所有个人数据

## 个性化应用场景

### 1. 解释风格调整
- **理性用户**：侧重逻辑分析、概率表述
- **感性用户**：侧重情感共鸣、励志建议

### 2. 历史模式参考
- **常问事业**：增加事业相关的深度分析
- **多次占卜同一问题**：提醒用户关注行动而非反复占卜

### 3. 建议个性化
- **新手用户**：提供更多背景知识和解释
- **资深用户**：直接给出核心解读

## 注意事项

1. **数据时效性**：画像数据实时更新，每次占卜后自动刷新统计
2. **降级策略**：获取失败不影响主流程，Explainer 会使用通用模板
3. **隐私合规**：所有画像数据使用符合相关法律法规
4. **用户控制**：用户可在设置中关闭个性化功能

## 性能指标

- **平均响应时间**：<100ms（数据库查询）
- **成功率**：>99%
- **缓存策略**：会话期间缓存画像，减少数据库查询

## JSON Schema

```json
{
  "type": "function",
  "function": {
    "name": "get_user_profile",
    "description": "获取用户画像信息，包括性别、历史占卜次数、偏好问题类型等。用于个性化解释生成。所有数据使用符合隐私保护法规。",
    "parameters": {
      "type": "object",
      "properties": {
        "user_id": {
          "type": "integer",
          "description": "用户 ID"
        }
      },
      "required": ["user_id"]
    }
  }
}
```

## 相关工具

- **get_user_history**：获取用户占卜历史记录
- **update_user_profile**：更新用户画像（未实现）
