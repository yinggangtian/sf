# RAG 知识库检索工具

## 工具名称
`rag_search`

## 功能描述
检索六壬知识库，获取与关键词相关的典籍内容和解释。支持多关键词检索，返回最相关的知识片段，用于增强占卜解释的专业性和准确性。

## 参数说明

### 必填参数

- **keywords** (array of strings)
  - 描述：检索关键词列表
  - 示例：`["青龙", "坎宫", "用神"]`
  - 说明：支持多个关键词，系统会找到与所有关键词相关的内容

### 可选参数

- **top_k** (integer)
  - 描述：返回结果数量
  - 范围：1-10
  - 默认值：5
  - 说明：限制返回的知识片段数量，避免信息过载

- **timeout** (number)
  - 描述：超时时间（秒）
  - 范围：0.1-10.0
  - 默认值：3.0
  - 说明：检索超时后自动降级，不影响主流程

## 返回格式

```json
{
  "success": true,
  "chunks": [
    {
      "chunk_text": "青龙为六兽之首，主文书、财帛、喜庆之事...",
      "metadata": {
        "source": "六壬神煞解析",
        "chapter": "六兽篇",
        "page": 42
      },
      "score": 0.95
    }
  ],
  "total_results": 3,
  "degraded": false
}
```

## 使用示例

**输入：**
```python
{
  "keywords": ["青龙", "坎宫"],
  "top_k": 3,
  "timeout": 3.0
}
```

**输出：**
- 返回 3 个最相关的知识片段
- 每个片段包含文本、来源、相似度分数

## 超时与降级机制

### 正常响应（3 秒内）
- 返回完整检索结果
- `degraded: false`

### 超时降级（超过 3 秒）
- 返回空结果列表
- `degraded: true`
- 不抛出异常，不中断主流程

### 降级影响
- **对用户**：解释中不包含典籍引用，但仍能获得基础解读
- **对系统**：不影响 Explainer 生成解释，仅缺少 RAG 增强部分

## 注意事项

1. **关键词选择**：建议使用专业术语（如"青龙"、"坎宫"）而非白话（如"龙"、"水"）
2. **结果数量**：top_k 越大，检索时间越长，建议使用默认值 5
3. **超时设置**：默认 3 秒已足够，不建议设置过长
4. **降级策略**：超时或失败不影响占卜主流程，可放心调用

## 性能指标

- **平均响应时间**：0.5-1.5 秒
- **超时阈值**：3 秒
- **成功率**：>95%
- **降级率**：<5%

## JSON Schema

```json
{
  "type": "function",
  "function": {
    "name": "rag_search",
    "description": "检索六壬知识库，获取相关的典籍内容和解释。支持多关键词检索，返回最相关的知识片段。超时后自动降级，不影响主流程。",
    "parameters": {
      "type": "object",
      "properties": {
        "keywords": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "检索关键词列表，例如：['青龙', '坎宫', '用神']",
          "minItems": 1
        },
        "top_k": {
          "type": "integer",
          "description": "返回结果数量，默认 5，范围 1-10",
          "minimum": 1,
          "maximum": 10,
          "default": 5
        },
        "timeout": {
          "type": "number",
          "description": "超时时间（秒），默认 3.0。超时后自动降级返回空结果。",
          "minimum": 0.1,
          "maximum": 10.0,
          "default": 3.0
        }
      },
      "required": ["keywords"]
    }
  }
}
```

## 数据来源

知识库包含以下典籍内容：
- 《六壬大全》
- 《六壬神煞解析》
- 《六壬宫位详解》
- 《小六壬速断》
- 现代六壬实战案例

所有内容均已向量化，支持语义检索。
